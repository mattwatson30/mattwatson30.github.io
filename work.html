<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Work Projects — Matthew Watson</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- Global Styles --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary-blue: #0000FF; --text-primary: #212529; --text-secondary: #6c757d;
            --background: #f8f9fa; --card-background: #ffffff; --border-color: #dee2e6;
            --border-light: #e9ecef;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Montserrat', sans-serif; background-color: var(--background);
            color: var(--text-primary); line-height: 1.6; padding: 40px 20px; font-weight: 300;
        }
        a { color: var(--primary-blue); text-decoration: none; font-weight: 500; transition: opacity 0.2s ease; }
        a:hover { text-decoration: none; opacity: 0.7; }

        /* --- Header & Footer --- */
        header, footer { text-align: center; max-width: 900px; margin: 0 auto; }
        header { margin-bottom: 70px; }
        h1 { font-weight: 600; font-size: 2.5rem; letter-spacing: 1px; margin-bottom: 10px; }
        footer { margin-top: 100px; padding-top: 40px; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9rem; }
        footer p:first-child a { margin: 0 10px; }
        .back-link { font-size: 1rem; color: var(--text-secondary); display: inline-block; margin-top: 10px; transition: color 0.2s ease; }
        .back-link:hover { color: var(--primary-blue); opacity: 1; }

        /* --- Project Accordion List --- */
        .project-list { max-width: 900px; margin: 0 auto; list-style: none; }
        .project-item {
            background-color: var(--card-background); border: 1px solid var(--border-light);
            border-radius: 18px; margin-bottom: 30px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: box-shadow 0.3s ease, margin-bottom 0.4s ease, border-color 0.4s ease, background-color 0.4s ease;
        }

        /* --- Project Preview (Clickable Header) --- */
        .project-preview {
            padding: 20px; cursor: pointer; display: flex; align-items: center; gap: 20px;
            transition: background-color 0.2s ease, opacity 0.4s ease, max-height 0.4s ease, padding 0.4s ease;
            position: relative; max-height: 200px; opacity: 1;
        }
        .project-preview:hover { background-color: #fcfcfc; }
        .project-list.item-active .project-item:not(.active) .project-preview {
            opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0;
            pointer-events: none; border-width: 0; margin-bottom: 0;
        }
        .project-list.item-active .project-item:not(.active) { margin-bottom: 0; box-shadow: none; border-color: transparent; background-color: transparent; }
        .preview-image-container { width: 100px; height: 100px; border-radius: 12px; overflow: hidden; flex-shrink: 0; position: relative; background-color: #eee; }
        .preview-image-container img { display: block; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .preview-image-container img.active { opacity: 1; }
        .preview-text { flex-grow: 1; position: relative; }
        .project-preview h3 { font-size: 1.25rem; font-weight: 500; margin-bottom: 5px; color: var(--text-primary); padding-right: 40px; }
        .project-preview .meta { font-size: 0.9rem; color: var(--text-secondary); font-style: italic; font-weight: 300; }

        /* --- Logo: vertically center within header preview --- */
        .preview-company-logo {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 20px;
            max-width: 80px;
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .preview-icon { display: inline-block; font-size: 1.5rem; color: var(--text-secondary); transition: transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1); margin-left: 15px; flex-shrink: 0; line-height: 1; transform: rotate(0deg); }
        .project-item.active .preview-icon { transform: rotate(-180deg); }

        /* --- Project Details (Hidden Content) --- */
        .project-details {
            max-height: 0; overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1), padding-top 0.6s cubic-bezier(0.4, 0, 0.2, 1), padding-bottom 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 1px solid transparent; padding: 0 30px;
        }
        .project-item.active .project-details { max-height: 2500px; padding-top: 30px; padding-bottom: 30px; border-top-color: var(--border-light); }
        .project-description { margin-top: 30px; }
        .project-description p { margin-bottom: 15px; color: #495057; font-weight: 300; }
        .project-description strong { font-weight: 600; color: var(--primary-blue); display: block; margin-bottom: 5px; }
        .project-description p b { font-weight: 500; color: var(--text-primary); }
         .details-links { margin-top: 25px; }

        /* --- Slideshow Styles --- */
        .slideshow-container {
            position: relative;
            max-width: 100%;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 12px;
            background-color: #eee;
            transition: height 0.45s cubic-bezier(0.2,0,0.2,1);
        }
        .slide {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            opacity: 0;
            transition: opacity 0.55s ease;
            pointer-events: none;
        }
        .slide img { display: block; width: 100%; height: auto; object-fit: contain; }
        .slide.active { opacity: 1; pointer-events: auto; }
        .prev, .next { cursor: pointer; position: absolute; top: 50%; transform: translateY(-50%); width: auto; padding: 16px; color: white; font-weight: bold; font-size: 20px; background-color: rgba(0, 0, 0, 0.3); border-radius: 0 3px 3px 0; user-select: none; transition: background-color 0.3s ease; }
        .next { right: 0; border-radius: 3px 0 0 3px; }
        .prev:hover, .next:hover { background-color: rgba(0, 0, 0, 0.6); }

        /* --- Caption Styles --- */
        .caption-container { text-align: center; padding: 10px 0 5px 0; color: var(--text-secondary); font-size: 0.9rem; min-height: 1.5em; font-style: italic; transition: opacity 0.15s ease-in-out; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
             body { padding: 30px 15px; } header { margin-top: 60px; } .project-preview { padding: 15px; gap: 15px; }
             .project-item.active .project-details { padding: 20px; } .preview-image-container { width: 70px; height: 70px; border-radius: 8px;}
             .project-preview h3 { font-size: 1.1rem; padding-right: 30px; } .project-preview .meta { font-size: 0.85rem;}
             .preview-company-logo { height: 16px; } .preview-icon { margin-left: 10px; font-size: 1.2rem; }
             .prev, .next { font-size: 16px; padding: 12px; } .slide img { max-height: 400px; object-fit: contain; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Work Projects</h1>
        <a href="index.html" class="back-link">&larr; Back to Home</a>
    </header>

    <ul class="project-list">
        
        <li class="project-item" data-project-id="tesla-scheduling">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <!-- Replace these with your architecture diagram/graph -->
                     <img src="images/tesla-giga-texas.jpeg" alt="Tesla Giga Texas Factory, One of Tesla's Major Factories Using this Software" class="active" onerror="this.src='https://placehold.co/100x100?text=System+Arch'">
                     <img src="images/model_Y_assembly_line_tesla.png" alt="Tesla Assembly Line Workers, Assigned Work Using this Software" onerror="this.src='https://placehold.co/100x100?text=Speed+Graph'">
                 </div>
                 <div class="preview-text">
                     <h3>AI-Driven Employee Scheduling Software</h3>
                     <p class="meta">Pilot Engineering Intern - Technical Product Owner @ Tesla</p>
                     <img src="images/logo-tesla.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/tesla-giga-texas.jpeg" alt="Tesla Giga Texas Factory, One of Tesla's Major Factories Using this Software" onerror="this.src='https://placehold.co/800x400?text=Architecture+Diagram'"></div>
                    <div class="slide"><img src="images/model_Y_assembly_line_tesla.png" alt="Tesla Assembly Line Workers, Assigned Work Using this Software" onerror="this.src='https://placehold.co/800x400?text=Performance+Graph'"></div>
                    <a class="prev" onclick="manualSlideChange('tesla-scheduling', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('tesla-scheduling', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Global factory scheduling was a manual process with near-infinite complexity 
                        (10<sup>136</sup> combinations for a single 40-employee team), leading to sub-optimal workforce allocation. A business case I developed 
                        with Tesla's Finance Team identified a <b>$55M/year opportunity</b> on the Giga Texas Model Y line alone 
                        due to OEE losses from untrained assignments and <b>$1.1M/year</b> in wasted supervisory labor.</p>
                    <p><strong>My Solution:</strong> I led the 0→1 development of a constraint-based scheduling platform. I personally 
                        developed the core optimization engine using <b>Timefold (Java/Python)</b>, which <b>outperformed the internal 
                            data engineering team's solution</b> and was selected for production. I engineered a "Warm Start" server 
                        strategy that pre-calculates baselines overnight, reducing generation latency by <b>95% (from 8.62s to 0.47s per team)</b>.</p>
                    <p><strong>Results:</strong> Acting as the Technical Product Owner, I managed the transition from my prototype to a full-stack 
                        engineering team, defining API requirements and leading cross-functional alignment across <b>Austin, Fremont, and Berlin</b>. 
                        My algorithm is now used to <b>schedule thousands of factory workers every day</b>, enforcing 100% training compliance and 
                        optimizing workforce rotation to reduce fatigue.</p>
                </div>
            </div>
        </li>

        <!-- 2. Process Design/Simulation Software -->
        <li class="project-item" data-project-id="tesla-sim">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/tesla-sim-1.png" alt="Simulation Interface" class="active" onerror="this.src='https://placehold.co/100x100?text=Sim+1'">
                     <img src="images/tesla-sim-2.png" alt="Line Design Visualization" onerror="this.src='https://placehold.co/100x100?text=Sim+2'">
                 </div>
                 <div class="preview-text">
                     <h3>Model Y & Cybertruck Process Design/Simulation Software</h3>
                     <p class="meta">Pilot Engineering Intern @ Tesla</p>
                     <img src="images/logo-tesla.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/tesla-sim-1.png" alt="Simulation Interface" onerror="this.src='https://placehold.co/800x400?text=Simulation+Interface'"></div>
                    <div class="slide"><img src="images/tesla-sim-2.png" alt="Line Design Visualization" onerror="this.src='https://placehold.co/800x400?text=Line+Visualization'"></div>
                    <a class="prev" onclick="manualSlideChange('tesla-sim', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('tesla-sim', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Engineers working on Model Y and Cybertruck lines lacked a unified tool to visualize line designs and detect timing issues before physical implementation, leading to costly iteration cycles.</p>
                    <p><strong>My Solution:</strong> I shipped an internal engineering design simulation product tailored for <b>20+ engineers</b>. The software visualizes line designs in real-time and automatically detects timing bottlenecks and process clashes.</p>
                    <p><strong>Results:</strong> The tool standardized design validation across the team, significantly accelerating the iteration speed for new process designs and reducing the risk of physical implementation errors.</p>
                </div>
            </div>
        </li>

        <!-- 3. Audit Automation -->
        <li class="project-item" data-project-id="tesla-audit">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/tesla-audit-1.png" alt="Audit Dashboard" class="active" onerror="this.src='https://placehold.co/100x100?text=Audit+1'">
                     <img src="images/tesla-audit-2.png" alt="Automated Report Example" onerror="this.src='https://placehold.co/100x100?text=Audit+2'">
                 </div>
                 <div class="preview-text">
                     <h3>Model Y & Cybertruck Audit Automation</h3>
                     <p class="meta">Pilot Engineering Intern @ Tesla</p>
                     <img src="images/logo-tesla.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/tesla-audit-1.png" alt="Audit Dashboard" onerror="this.src='https://placehold.co/800x400?text=Audit+Dashboard'"></div>
                    <div class="slide"><img src="images/tesla-audit-2.png" alt="Automated Report Example" onerror="this.src='https://placehold.co/800x400?text=Report+Example'"></div>
                    <a class="prev" onclick="manualSlideChange('tesla-audit', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('tesla-audit', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Maintaining process compliance on the Model Y and Cybertruck lines required manual, time-consuming audits that were prone to human error and data lag.</p>
                    <p><strong>My Solution:</strong> I developed an automated auditing system that continuously validates process parameters against engineering standards. This involved integrating data streams from the line directly into a reporting framework.</p>
                    <p><strong>Results:</strong> This automation reduced the manual workload for the quality and engineering teams, ensuring real-time compliance visibility and faster reaction times to process deviations.</p>
                </div>
            </div>
        </li>

        <!-- 4. CSC Certifications Automation -->
        <li class="project-item" data-project-id="lm-certs">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/lm-certs-1.png" alt="IBM DOORS Workflow" class="active" onerror="this.src='https://placehold.co/100x100?text=Certs+1'">
                     <img src="images/lm-certs-2.png" alt="Python Script Logic" onerror="this.src='https://placehold.co/100x100?text=Certs+2'">
                 </div>
                 <div class="preview-text">
                     <h3>CSC Certifications Automation Software</h3>
                     <p class="meta">Systems Engineering Intern @ Lockheed Martin</p>
                     <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/lm-certs-1.png" alt="IBM DOORS Workflow" onerror="this.src='https://placehold.co/800x400?text=IBM+DOORS+Workflow'"></div>
                    <div class="slide"><img src="images/lm-certs-2.png" alt="Python Script Logic" onerror="this.src='https://placehold.co/800x400?text=Python+Script'"></div>
                    <a class="prev" onclick="manualSlideChange('lm-certs', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('lm-certs', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Managing requirements for the Royal Canadian Navy River-Class Destroyer involved manual data processing that was slow and expensive. The team needed to align requirements with ANEP-77 and Lloyd’s Register standards across multiple stakeholders.</p>
                    <p><strong>My Solution:</strong> I engineered an automated requirements ingestion workflow for IBM DOORS using <b>Python (Pandas), SQL, and VBA</b>. I owned the workflow from intake to rollout, translating stakeholder needs into specific import rules and acceptance criteria.</p>
                    <p><strong>Results:</strong> The automation saved <b>4,450 work hours ($380,000) annually</b> by eliminating manual data processing and ensured full traceability and compliance across internal teams and external partners.</p>
                </div>
            </div>
        </li>

        <!-- 5. Mobile App for Repair Truck Drivers -->
        <li class="project-item" data-project-id="jdi-app">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/jdi-app-1.png" alt="Mobile Power BI Interface" class="active" onerror="this.src='https://placehold.co/100x100?text=App+1'">
                     <img src="images/jdi-app-2.png" alt="Scheduling Logic" onerror="this.src='https://placehold.co/100x100?text=App+2'">
                 </div>
                 <div class="preview-text">
                     <h3>Mobile App for Repair Truck Drivers</h3>
                     <p class="meta">Data Engineering Intern @ J.D. Irving</p>
                     <!-- Placeholder logo for JDI if you have one, or remove -->
                     <div style="width:20px;"></div> 
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/jdi-app-1.png" alt="Mobile Power BI Interface" onerror="this.src='https://placehold.co/800x400?text=Mobile+Interface'"></div>
                    <div class="slide"><img src="images/jdi-app-2.png" alt="Scheduling Logic" onerror="this.src='https://placehold.co/800x400?text=Scheduling+Logic'"></div>
                    <a class="prev" onclick="manualSlideChange('jdi-app', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('jdi-app', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> The Transportation & Logistics Division faced critical workflow bottlenecks in scheduling repair trucks, leading to lost revenue and inefficient routing.</p>
                    <p><strong>My Solution:</strong> I partnered with shop managers to identify the root causes and developed a mobile <b>Power BI solution backed by SQL</b>. This tool provided real-time analytics and optimized scheduling directly to the drivers' mobile devices.</p>
                    <p><strong>Results:</strong> The solution recovered <b>$120,000 in lost revenue</b> through optimized scheduling and improved fleet utilization.</p>
                </div>
            </div>
        </li>

        <!-- 6. CSC TDP Delivery Jira Automation -->
        <li class="project-item" data-project-id="lm-jira">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/lm-jira-1.png" alt="Jira Automation Flow" class="active" onerror="this.src='https://placehold.co/100x100?text=Jira+1'">
                     <img src="images/lm-jira-2.png" alt="Data Validation Script" onerror="this.src='https://placehold.co/100x100?text=Jira+2'">
                 </div>
                 <div class="preview-text">
                     <h3>CSC TDP Delivery Jira Automation</h3>
                     <p class="meta">Electrical Engineering Intern @ Lockheed Martin</p>
                     <img src="images/logo-lockheed.png" alt="" class="preview-company-logo">
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/lm-jira-1.png" alt="Jira Automation Flow" onerror="this.src='https://placehold.co/800x400?text=Jira+Flow'"></div>
                    <div class="slide"><img src="images/lm-jira-2.png" alt="Data Validation Script" onerror="this.src='https://placehold.co/800x400?text=Validation+Script'"></div>
                    <a class="prev" onclick="manualSlideChange('lm-jira', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('lm-jira', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Supply chain and engineering teams were facing a critical data integrity issue that required manual review of Technical Data Packages (TDPs), costing significant time and money.</p>
                    <p><strong>My Solution:</strong> I developed an automated validation script using <b>Python (Pandas, NumPy)</b> to clean and verify data before it entered the Jira workflow. I collaborated with supply chain and engineering teams to define validation rules and integrate the solution into existing procurement workflows.</p>
                    <p><strong>Results:</strong> The automation saved <b>$129,000 annually</b> by eliminating the need for manual review and ensuring higher data quality for the program.</p>
                </div>
            </div>
        </li>

        <!-- 7. Reporting Metrics Data Automation Pipeline -->
        <li class="project-item" data-project-id="metrics-pipeline">
            <div class="project-preview">
                 <div class="preview-image-container">
                     <img src="images/pipeline-1.png" alt="Pipeline Architecture" class="active" onerror="this.src='https://placehold.co/100x100?text=Pipeline+1'">
                     <img src="images/pipeline-2.png" alt="Reporting Dashboard" onerror="this.src='https://placehold.co/100x100?text=Pipeline+2'">
                 </div>
                 <div class="preview-text">
                     <h3>Reporting Metrics Data Automation Pipeline</h3>
                     <p class="meta">Data Engineering Intern</p>
                     <!-- Placeholder logo or remove -->
                     <div style="width:20px;"></div>
                 </div>
                 <span class="preview-icon">›</span>
            </div>
            <div class="project-details">
                <div class="slideshow-container">
                    <div class="slide active"><img src="images/pipeline-1.png" alt="Pipeline Architecture" onerror="this.src='https://placehold.co/800x400?text=Pipeline+Architecture'"></div>
                    <div class="slide"><img src="images/pipeline-2.png" alt="Reporting Dashboard" onerror="this.src='https://placehold.co/800x400?text=Dashboard+View'"></div>
                    <a class="prev" onclick="manualSlideChange('metrics-pipeline', -1)">&#10094;</a>
                    <a class="next" onclick="manualSlideChange('metrics-pipeline', 1)">&#10095;</a>
                </div>
                <div class="caption-container"></div>
                <div class="project-description">
                    <p><strong>Problem:</strong> Key operational metrics were siloed in disparate systems, requiring manual extraction and formatting to generate reports for leadership.</p>
                    <p><strong>My Solution:</strong> I built a robust data pipeline that automates the extraction, transformation, and loading (ETL) of reporting metrics. This ensured that data was consistently cleaned and available for real-time reporting.</p>
                    <p><strong>Results:</strong> The pipeline reduced reporting latency from days to minutes, enabling leadership to make data-driven decisions based on the most current operational status.</p>
                </div>
            </div>
        </li>

    </ul>

    <footer>
        <p>
            <a href="images/resume.pdf" target="_blank"> Download Resume</a> ·
            <a href="mailto:matthewwatson311@gmail.com">Email Me</a> ·
            <a href="https://linkedin.com/in/matthewwatson311" target="_blank">LinkedIn</a>
        </p>
        <p>© 2026 Matthew Watson</p>
    </footer>

    <script>
        // --- Accordion Logic & Slideshow Data ---
        const projectItems = Array.from(document.querySelectorAll('.project-item'));
        const slideshowData = {};
        const previewSlideshowData = {};

        // --- Utilities: wait for image to be ready ---
        function waitForImageLoad(img, timeout = 4000) {
            return new Promise(resolve => {
                if (!img) return resolve();
                if (img.complete && img.naturalWidth) return resolve();
                const onDone = () => {
                    img.removeEventListener('load', onDone);
                    img.removeEventListener('error', onDone);
                    resolve();
                };
                img.addEventListener('load', onDone);
                img.addEventListener('error', onDone);
                setTimeout(() => {
                    img.removeEventListener('load', onDone);
                    img.removeEventListener('error', onDone);
                    resolve();
                }, timeout);
            });
        }

        // --- compute pixel height for container ---
        function computeHeightForImage(container, img) {
            if (!container || !img) return 300;
            const naturalW = img.naturalWidth || img.width || 1;
            const naturalH = img.naturalHeight || img.height || 1;
            const width = container.clientWidth || container.offsetWidth || 600;
            if (naturalW && naturalH) {
                return Math.max(120, Math.round(width * naturalH / naturalW));
            }
            try {
                const rect = img.getBoundingClientRect();
                if (rect && rect.height > 0) return rect.height;
            } catch (e) {}
            return Math.max(120, Math.round(width * 0.6));
        }

        // --- keep per-container ResizeObserver ---
        const resizeObservers = new Map();
        function attachResizeObserver(container, activeImg, projectId) {
            if (!container) return;
            if (resizeObservers.has(container)) return;
            const ro = new ResizeObserver(() => {
                const data = slideshowData[projectId];
                if (!data) return;
                const active = container.querySelector('.slide.active img') || activeImg;
                if (!active) return;
                const h = computeHeightForImage(container, active);
                container.style.height = h + 'px';
            });
            ro.observe(container);
            resizeObservers.set(container, ro);
        }
        function detachResizeObserver(container) {
            const ro = resizeObservers.get(container);
            if (ro) {
                try { ro.disconnect(); } catch(e){}
                resizeObservers.delete(container);
            }
        }

        // --- Initialize Data ---
        function initializeSlideshow(projectId) {
            if (!slideshowData[projectId]) {
                const projectItem = document.querySelector(`.project-item[data-project-id="${projectId}"]`);
                const slides = Array.from(projectItem.querySelectorAll('.project-details .slide'));
                const captions = slides.map(slide => {
                    const img = slide.querySelector('img');
                    return img ? (img.alt || '') : '';
                });
                slideshowData[projectId] = {
                    slideIndex: 0,
                    slides: slides,
                    captions: captions,
                    timer: null,
                    captionElement: projectItem.querySelector('.project-details .caption-container'),
                    containerElement: projectItem.querySelector('.slideshow-container'),
                    projectItem: projectItem
                };
            }
        }
        function initializePreviewSlideshow(projectId) {
            if (!previewSlideshowData[projectId]) {
                const projectItem = document.querySelector(`.project-item[data-project-id="${projectId}"]`);
                const previewContainer = projectItem.querySelector('.preview-image-container');
                const previewImages = Array.from(previewContainer.querySelectorAll('img'));
                previewSlideshowData[projectId] = {
                    previewIndex: 0, previewImages: previewImages, previewTimer: null
                };
            }
        }

        // --- Preview small image slideshow ---
        function showPreviewImage(projectId, index) {
             initializePreviewSlideshow(projectId);
             const data = previewSlideshowData[projectId];
             if (!data || !data.previewImages || data.previewImages.length === 0) return;
             if (index >= data.previewImages.length) { index = 0; }
             if (index < 0) { index = data.previewImages.length - 1; }
             data.previewImages.forEach(img => img.classList.remove('active'));
             data.previewImages[index].classList.add('active');
             data.previewIndex = index;
        }
        function startPreviewAutoSlide(projectId) {
             initializePreviewSlideshow(projectId);
             const data = previewSlideshowData[projectId];
             if (!data || data.previewImages.length <= 1) return;
             stopPreviewAutoSlide(projectId);
             showPreviewImage(projectId, 0); 
             data.previewTimer = setInterval(() => { showPreviewImage(projectId, data.previewIndex + 1); }, 3000);
        }
        function stopPreviewAutoSlide(projectId) {
             if (previewSlideshowData[projectId] && previewSlideshowData[projectId].previewTimer) {
                 clearInterval(previewSlideshowData[projectId].previewTimer);
                 previewSlideshowData[projectId].previewTimer = null;
             }
        }

        // --- Show a main slideshow slide ---
        function showSlide(projectId, index) {
            initializeSlideshow(projectId);
            const data = slideshowData[projectId];
            if (!data || !data.slides || data.slides.length === 0) return;
            if (index >= data.slides.length) index = 0;
            if (index < 0) index = data.slides.length - 1;

            if (data.slideIndex === index) {
                if (data.captionElement) {
                    data.captionElement.style.opacity = 0;
                    setTimeout(() => {
                        data.captionElement.textContent = data.captions[index] || '';
                        data.captionElement.style.opacity = 1;
                    }, 150);
                }
                return;
            }

            const targetSlide = data.slides[index];
            const targetImg = targetSlide.querySelector('img');

            stopPreviewAutoSlide(projectId);

            return waitForImageLoad(targetImg, 4000).then(() => {
                const container = data.containerElement;
                const targetHeight = computeHeightForImage(container, targetImg);
                container.style.height = targetHeight + 'px';
                container.getBoundingClientRect();

                data.slides.forEach(s => s.classList.remove('active'));
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        targetSlide.classList.add('active');
                        data.slideIndex = index;
                        if (data.captionElement) {
                            data.captionElement.style.opacity = 0;
                            setTimeout(() => {
                                data.captionElement.textContent = data.captions[index] || '';
                                data.captionElement.style.opacity = 1;
                            }, 150);
                        }
                    });
                });
                attachResizeObserver(container, targetImg, projectId);
                return Promise.resolve();
            });
        }

        function manualSlideChange(projectId, n) {
             initializeSlideshow(projectId);
             const data = slideshowData[projectId];
             stopAutoSlide(projectId); 
             Promise.resolve(showSlide(projectId, data.slideIndex + n)).then(() => {
                 setTimeout(() => startAutoSlide(projectId), 8000);
             });
         }
        function startAutoSlide(projectId) {
             initializeSlideshow(projectId);
            const data = slideshowData[projectId];
            if (!data || data.slides.length <= 1) return;
            stopAutoSlide(projectId);
             data.timer = setInterval(() => {
                 showSlide(projectId, data.slideIndex + 1);
            }, 5000);
        }
        function stopAutoSlide(projectId) {
            if (slideshowData[projectId] && slideshowData[projectId].timer) {
                 clearInterval(slideshowData[projectId].timer);
                 slideshowData[projectId].timer = null;
            }
        }

        function animateHeightTo(container, fromPx, toPx, timeout = 650) {
            return new Promise(resolve => {
                if (!container) return resolve();
                let done = false;
                const onEnd = (e) => {
                    if (e && e.target !== container) return;
                    if (done) return;
                    done = true;
                    container.removeEventListener('transitionend', onEnd);
                    resolve();
                };
                container.addEventListener('transitionend', onEnd);
                container.style.height = fromPx + 'px';
                container.getBoundingClientRect();
                requestAnimationFrame(() => {
                    container.style.height = toPx + 'px';
                });
                setTimeout(() => { if (!done) { done = true; container.removeEventListener('transitionend', onEnd); resolve(); } }, timeout + 100);
            });
        }

        projectItems.forEach(item => {
            const summary = item.querySelector('.project-preview');
            const projectId = item.getAttribute('data-project-id');
            startPreviewAutoSlide(projectId);

            summary.addEventListener('click', async () => {
                const wasActive = item.classList.contains('active');
                const list = item.closest('.project-list');

                for (const otherItem of projectItems) {
                    if (otherItem !== item && otherItem.classList.contains('active')) {
                        const otherId = otherItem.getAttribute('data-project-id');
                        otherItem.classList.remove('active');
                        const otherData = slideshowData[otherId];
                        if (otherData) stopAutoSlide(otherId);
                        const otherContainer = otherItem.querySelector('.slideshow-container');
                        if (otherContainer) {
                            otherItem.classList.add('closing');
                            const curH = otherContainer.getBoundingClientRect().height || otherContainer.clientHeight || 0;
                            await animateHeightTo(otherContainer, curH, 0);
                            otherContainer.style.height = '';
                            otherItem.classList.remove('closing');
                            detachResizeObserver(otherContainer);
                        }
                        startPreviewAutoSlide(otherId);
                    }
                }

                if (!wasActive) { 
                    item.classList.add('active');
                    list.classList.add('item-active');
                    initializeSlideshow(projectId);
                    stopPreviewAutoSlide(projectId);

                    const data = slideshowData[projectId];
                    const container = data.containerElement;
                    const initialSlide = container.querySelector('.slide') || data.slides[0];
                    const initialImg = initialSlide ? initialSlide.querySelector('img') : null;

                    if (initialImg) await waitForImageLoad(initialImg, 4000);
                    const targetH = computeHeightForImage(container, initialImg || container.querySelector('img'));
                    await animateHeightTo(container, 0, targetH);
                    await showSlide(projectId, 0);
                    startAutoSlide(projectId);
                } else { 
                    const data = slideshowData[projectId];
                    const container = data ? data.containerElement : (item.querySelector('.slideshow-container'));
                    if (container) {
                        item.classList.add('closing');
                        stopAutoSlide(projectId);
                        const curH = container.getBoundingClientRect().height || container.clientHeight || 0;
                        await animateHeightTo(container, curH, 0);
                        container.style.height = '';
                        item.classList.remove('closing');
                        detachResizeObserver(container);
                    }
                    item.classList.remove('active');
                    list.classList.remove('item-active');
                    startPreviewAutoSlide(projectId);
                }
            });
        });

        const styleSheet = document.styleSheets[0];
         try {
             styleSheet.insertRule('.caption-container { transition: opacity 0.15s ease-in-out; }', styleSheet.cssRules.length);
             styleSheet.insertRule('.project-list.item-active .project-item:not(.active) { transition: opacity 0.4s ease, max-height 0.4s ease, margin-bottom 0.4s ease, border-color 0.4s ease, background-color 0.4s ease, box-shadow 0.4s ease; }', styleSheet.cssRules.length);
         } catch (e) { }

        (function openProjectFromURL() {
            try {
                const hashId = window.location.hash ? decodeURIComponent(window.location.hash.substring(1)) : '';
                const params = new URLSearchParams(window.location.search);
                const projParam = params.get('project') ? decodeURIComponent(params.get('project')) : '';
                const targetId = hashId || projParam;
                if (!targetId) return;

                const targetPreview = document.querySelector(`.project-item[data-project-id="${targetId}"] .project-preview`);
                if (targetPreview) {
                    setTimeout(() => {
                        targetPreview.click();
                        try { targetPreview.scrollIntoView({ behavior: 'smooth', block: 'center' }); } catch (e) {}
                    }, 180);
                }
            } catch (e) { console.error('openProjectFromURL error:', e); }
        })();

        projectItems.forEach(p => {
            const id = p.getAttribute('data-project-id');
            if (!previewSlideshowData[id] || !previewSlideshowData[id].previewTimer) startPreviewAutoSlide(id);
        });
    </script>
</body>
</html>
